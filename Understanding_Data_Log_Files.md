---
output:
  pdf_document: default
  html_document: default
---
# Understanding Data Log Files

**_Updated 2021-02-22_**

## Background

South Coast is maintaining its own archive of PurpleAir data at:

https://airsensor.aqmd.gov/PurpleAir/v1/

Scripts run by cron jobs create data files full of `pas`, `pat` and `sensor` 
data as well as video files. These files are stored in a "well known directory 
structure" where they can be found by various `~_load()` functions in the
**AirSensor** package. 

Creation of the data archives is a bootstrapping process where generation of one 
type of data depends on input data that has been previously generated. This is 
reflected in the timings of the cron tasks in: 

https://github.com/MazamaScience/AQ-SPEC-sensor-data-ingest-v1/blob/master/crontabs_etc/crontab_daily_DO.txt

The hierarchy is:
1. pas (once daily)
2. pat latest
3. pat extended
4. airsensor latest
5. airsensor extended
6. airsensor annual (once daily)
7. videos (once daily)

## Log files

Each type of file is created by a separate R script and each R script produces
log files in this web accessible directory:

https://airsensor.aqmd.gov/PurpleAir/v1/logs/

### cron_log.txt

The `cron_log.txt` file contains error messages generated by `cron` and should 
be empty.  Errors in this file mean that `cron` was unable to run one of the 
scripts because of problems at the `docker` level.

### ERROR - INFO - DEBUG - TRACE

Each data processing script produces a set of four log files with increasing 
detail.

* `~ERROR.log` -- Should be empty. If not, this task did not complete successfully.
* `~INFO.log` -- Basic, top-level information. Includes all `ERROR` logs.
* `~DEBUG.log` -- Debugging level information with log statements following the 
path through the code. This can help identify the function in which a data
processing script may have failed. Includes all `ERROR` and `INFO` logs.
* `~TRACE.log` -- Super gory details including statements inside of loops and
lots of data validation checks. This file is really only for the programmer
responsible for fixing a problem. Includes all `ERROR`, `INFO` and `DEBUG` .logs.

## Keeping an eye on things

Real-time data processing is susceptible to many kinds of data provider errors 
including data formatting issues, latency, changing URLs, _etc._ Host 
machine issues include running out of disk space or RAM, docker going down, _etc._

It is important to keep an eye on things, preferably daily, so that problems can
be addressed as quickly as possible.

Reviewing the logs in https://airsensor.aqmd.gov/PurpleAir/v1/logs/ is the fastest
way to do this.

* **All files should have a recent timestamp.**
* **All `~_ERROR.log` files should have a size of 0.**

That's pretty much it.

If data is up-to-date at some locations but not at others, 
you can check the `INFO` or `DEBUG` logs to look for possible reasons.

